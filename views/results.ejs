<% layout("layouts/boilerplate") -%>
<link rel="stylesheet" href="stylesheets/resultsStyles.css">
<!-- We stop at each ingredient of tab 1 and then continue iterating ingredients until we find another ingredient of tab 1, then start 
this process again at the newfound ingredient of tab 1. Repeat until no more ingredients. 
The last ingredient is dealt with individually, possibly due to bad implementation.-->
<!-- EJS bug where details is rendered as div on refresh? -->
    <h1 class="text-center"><%=ingredients[0].data.number%> &times; <img src="<%=ingredients[0].data.image%>" alt=""> <%=ingredients[0].item%></h1>
    <div class="my-3 d-flex justify-content-center">
        <button class="btn btn-success" id="uncheck">Uncheck all</button>
    </div>
    <div class="row">
        <% if(displaySetting==="full"){ %> 

            <% ingredients.forEach((ingredient,idx)=>{ %>

                
                <% if(ingredient.tab===1){ %>
                    <details class="col-xl-6 my-2">
                        
                        
                    <%for(let i=idx; i<ingredients.length-1; i++ ){%>
                        
                        <%if(ingredients[i+1].tab===1){%>
                            <p>
                                <summary style="padding-left:<%=ingredients[i].tab*1.5%>em;font-weight: <%=600-50*ingredients[i].tab%>;" > 
                                    <input type="checkbox" id="<%=i%>" class="d-none d-md-inline-block d-md-inline mx-2 form-check-input">
                                        <label class="form-check-label tab<%=ingredients[i].tab%>" for="<%=i%>">
                                            <%=ingredients[i].data.number%> &times; <img src="<%=ingredients[i].data.image%>" alt=""> <%=ingredients[i].item%> 
                                        </label>
                                </summary>
                            </p>
                            
                            <%break;%>
                        <% }%>
                        <p>
                            
                            <summary style="padding-left:<%=ingredients[i].tab*1.5%>em;font-weight: <%=600-50*ingredients[i].tab%>;" >
                                <input type="checkbox" id="<%=i%>" class="d-none d-md-inline-block mx-2 form-check-input">
                                    <label class="form-check-label tab<%=ingredients[i].tab%>" for="<%=i%>">
                                        <%=ingredients[i].data.number%> &times; <img src="<%=ingredients[i].data.image%>" alt=""> <%=ingredients[i].item%> 
                                    </label>
                            </summary>
                        </p>
                    <% }%>
                    <!-- including two of these if-statements solves the bug of the last ingredient not appearing...
                    WHY DOES THIS WORK?!!?!?!?!?!?!?!
                    Seriously need to crawl through this step by step to figure it out. -->
                    <% if(idx===ingredients.length-1){ %>
                        <p>
                            
                            <summary style="padding-left:<%=ingredients[idx].tab*1.5%>em;font-weight: <%=600-50*ingredients[idx].tab%>;" >
                                <input type="checkbox" id="<%=idx%>" class="d-none d-md-inline-block mx-2 form-check-input">
                                    <label class="form-check-label tab<%=ingredients[idx].tab%>" for="<%=idx%>">
                                        <%=ingredients[idx].data.number%> &times; <img src="<%=ingredients[idx].data.image%>" alt=""> <%=ingredients[idx].item%> 
                                    </label>
                            </summary>
                        </p>
                    <% } %>
                    <% if(idx+1===ingredients.length-1){ %>
                        <p>

                            <summary style="padding-left:<%=ingredients[idx+1].tab*1.5%>em;font-weight: <%=600-50*ingredients[idx+1].tab%>;" >
                                <input type="checkbox" id="<%=idx+1%>" class="d-none d-md-inline-block mx-2 form-check-input">
                                    <label class="form-check-label tab<%=ingredients[idx].tab%>" for="<%=idx+1%>">
                                        <%=ingredients[idx+1].data.number%> &times; <img src="<%=ingredients[idx+1].data.image%>" alt=""> <%=ingredients[idx+1].item%> 
                                    </label>
                            </summary>
                        </p>
                    <% } %>
                </details>
                <% } %>
            <% }) %>
            <!-- <div class="col-xl-12 col-sm-12 d-flex flex-column align-items-center" >
                <p class="mt-4 fs-4">Price to make: <%=costData.priceToMake.string%> <img src="<%=costData.priceToMake.coinPile%>" data-bs-toggle="tooltip" title="<%=costData.priceToMake.string%>gp"></p>
                <%if(costData.profit.value <0){%>
                <p class="fs-4">Resale: <span class="text-danger">-<%=costData.profit.string%></span> <img src="<%=costData.profit.coinPile%>" data-bs-toggle="tooltip" title="<%=costData.profit.string%>gp"></p>
                <% }else if(costData.profit.value === 0){ %>
                    <p class="fs-4">Resale: <span><%=costData.profit.string%></span></p>
                <% }else{ %>
                <p class="fs-4">Resale: <span class="text-success"><%=costData.profit.string%></span> <img src="<%=costData.profit.coinPile%>" data-bs-toggle="tooltip" title="<%=costData.profit.string%>gp"></p>
                <% } %>
            </div> -->
        <% }else if(displaySetting === "essential"){ %> 
                <div class="col-xl-12 col-sm-12 d-flex flex-column align-items-center">       
                    <%ingredients.slice(1).forEach((ingredient,i)=>{%>    
                        <span style="font-size: 1.7em;">
                            <input type="checkbox" id="<%=i%>" class="d-none essential d-md-inline-block form-check-input">
                                <label class="form-check-label" for="<%=i%>">
                                    <%=ingredient.data.number%> &times; <img src="<%=ingredient.data.image%>"> <%=ingredient.item%> 
                                </label>
                        </span>
                    <%})%>
                    <!-- <p class="mt-4 fs-4">Price to make: <%=costData.priceToMake.string%> <img src="<%=costData.priceToMake.coinPile%>" data-bs-toggle="tooltip" title="<%=costData.priceToMake.string%>gp"></p>
                    <%if(costData.profit.value <0){%>
                    <p class="fs-4">Resale: <span class="text-danger">-<%=costData.profit.string%></span> <img src="<%=costData.profit.coinPile%>" data-bs-toggle="tooltip" title="<%=costData.profit.string%>gp"></p>
                    <% }else if(costData.profit.value === 0){ %>
                        <p class="fs-4">Resale: <span><%=costData.profit.string%></span></p>
                    <% }else{ %>
                    <p class="fs-4">Resale: <span class="text-success"><%=costData.profit.string%></span> <img src="<%=costData.profit.coinPile%>" data-bs-toggle="tooltip" title="<%=costData.profit.string%>gp"></p>
                    <% } %>  -->
                </div>
        <% }else{ %>
            <p>Error</p>    
        <% } %>  

    </div>
<div class="d-flex justify-content-center my-3">
    <a class="btn btn-success" href="/" id="newSearch">Search for a new potion</a>
</div>
<script src="/javascripts/boxesAndButton.js"></script>
<script src="/javascripts/bootstrapTooltips.js"></script>

<script>
    
</script>