<% layout("layouts/boilerplate") -%>

<div class="row d-flex justify-content-center">
    <div class="col-lg-6 col-sm-12">
        <form action="/results" method="GET" class="validated-form" id="mainInputs" novalidate>
            <div class="input-group input-group-lg mb-3">
                <span class="input-group-text" id="potionInput">Potion</span>
                <input type="text" class="form-control" name="name" placeholder="E.g. &quot;Elder overload&quot;" aria-label="(E.g. \'Elder Overload\')" aria-describedby="potionInput" required>
                <div class="valid-feedback">
                    Looks good!
                </div>
            </div>
            <div class="input-group input-group-lg mb-3">
                <span class="input-group-text" id="potionQuantity">Quantity</span>
                <input type="number" name="number" min="1" max="2147483647" class="form-control" placeholder="Number between 0 and 2,147,483,647" aria-label="Number of Potions" aria-describedby="potionQuantity" required>
                <div class="valid-feedback">
                    Looks good!
                </div>
            </div>
            <div class="d-flex justify-content-around">
                <div>
                    <input class="form-check-input" type="radio" name="display" id="optionEssential" value="essential" checked>
                    <label class="form-check-label" for="optionEssential" data-bs-toggle="tooltip" data-bs-placement="bottom"  title="Display only the primary ingredients.">
                        Essential display
                    </label>
                </div>
                <div>
                    <input class="form-check-input" type="radio" name="display" id="optionFull" value="full">
                    <label class="form-check-label" for="optionFull" data-bs-toggle="tooltip" data-bs-placement="bottom"  title="Display everything.">
                        Full display
                    </label>
                </div>
            </div>
            <div class="d-flex justify-content-center mt-3">
                <button class="btn btn-success" id="submitButton" >
                    <span class="spinner-border spinner-border-sm" role="status" id="spinner" hidden></span>
                </button>
            </div>
        </form>
    </div>
</div>

<script src="/javascripts/validateForms.js"></script>

<script>
    const button = document.querySelector("#submitButton");
    const spinner = document.querySelector("#spinner");

    const submitText = document.createElement("span");
    submitText.id = "submitText";
    submitText.append(document.createTextNode("Submit"));
    button.appendChild(submitText);

    const loadingText = document.createElement("span");
    loadingText.id = "loadingText";
    loadingText.append(document.createTextNode("Querying Database, please wait..."))
    
    const buttonSpan = document.querySelector("#submitText");
    const potionInput = document.querySelector("input[type='text']");
    const numberInput = document.querySelector("input[type='number']");

    button.addEventListener("click",()=>
    {
        if(!potionInput.matches(".form-control:invalid") && !numberInput.matches(".form-control:invalid"))
        {
            spinner.hidden = false;
            button.disabled = true;
            button.replaceChild(loadingText,submitText);  
        }
    })

</script>

<script>
    const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
    const tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
      return new bootstrap.Tooltip(tooltipTriggerEl)
    })
    console.log(tooltipList)
</script>